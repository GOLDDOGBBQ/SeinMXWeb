@using System.Globalization
@model SEINMX.Models.Inventario.ProductoBuscadorViewModel

@{
    ViewBag.Title = "Productos";
    CultureInfo cultureMx = new CultureInfo("es-MX");
}

<div class="container-fluid mt-4">

    <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white">
            <h3 class="card-title">
                <i class="fa-solid fa-dolly"></i> Lista de Productos
            </h3>
        </div>

        <div class="card-body">

            <!-- FILTROS -->
            <form method="get" class="row g-3">

                <div class="col-md-2">
                    <label class="form-label"># Producto</label>
                    <input type="text" name="IdProducto" class="form-control" placeholder="ID..."
                           value="@Model.IdProducto">
                </div>

                <div class="col-md-6">
                    <label class="form-label">Descripcion </label>
                    <input type="text" name="Descripcion" class="form-control" placeholder="Buscar..."
                           value="@Model.Descripcion">
                </div>

                <div class="col-md-2">
                    <label class="form-label">Codigo</label>
                    <input type="text" name="Codigo" class="form-control" placeholder="ID..."
                           value="@Model.Codigo">
                </div>
                <!-- BOTÓN DE BÚSQUEDA -->
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>
            </form>

            <hr/>


            <!-- BOTÓN AGREGAR CLIENTE -->
            <div class="mb-3">
                <button class="btn btn-primary"
                        onclick="location.href='@Url.Action("Crear", "Producto")'">
                    Agregar Producto
                </button>
            </div>


            <!-- TABLA -->
            <div class="table-responsive">
                <table class="table table-sm table-striped table-hover table-bordered">
                    <thead class="table-dark">
                    <tr>
                        <th><i class="fa-solid fa-hashtag"></i> Producto</th>
                        <th><i class="fa-solid fa-barcode"></i> Codigo</th>
                        <th><i class="fa-solid fa-circle-info"></i> Descripcion</th>
                        <th><i class="fa-regular fa-money-bill-1"></i> PrecioLista</th>
                        <th><i class="fa-solid fa-dollar-sign"></i> Moneda</th>
                        <th><i class="fa-solid fa-id-card-clip"></i> Proveedor</th>
                        <th><i class="fa-regular fa-comment-dots"></i> Observaciones</th>
                        <th><i class="fas fa-gear"></i> Opciones</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model.Productos)
                    {
                        <tr id="row-@item.IdProducto">
                            <td>@item.IdProducto</td>
                            <td>@item.Codigo</td>
                            <td>@item.Descripcion</td>
                            <td>
                                @string.Format(cultureMx, "{0:C}", item.PrecioLista)
                            </td>
                            <td>@item.Moneda</td>
                            <td>@item.Proveedor</td>
                            <td>@item.Observaciones</td>
                            <td>
                                <button class="btn btn-sm btn-primary"
                                        onclick="location.href='@Url.Action("Editar", "Producto", new { id = item.IdProducto })'">
                                    <i class="fas fa-pen-to-square"></i>
                                </button>

                                <a class="btn btn-sm btn-danger btnEliminar">
                                    <i class="fa-solid fa-trash-can"></i>
                                </a>


                            </td>
                        </tr>
                    }
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>

@section Scripts
{
    <script>

        function isError(json) {
            if (!json.ok) {
                //  alert(json.msg);
                showToast("Error", json.msg ?? "Ocurrió un error", "error");
                return true;
            }
            return false;

        }

        // Eliminar producto
        document.addEventListener("click", async (e) => {
            if (e.target.closest(".btnEliminar")) {
                let row = e.target.closest("tr");
                let idProducto = row.dataset.id;

                const res = await fetch(`/Producto/Delete?idProducto=${idProducto}`, {
                    method: "DELETE",
                });

                const json = await res.json();
                if (isError(json)) {
                    return;
                }
                showToast("Producto eliminado", "Se eliminó el producto correctamente");

            }
        });


    </script>


}


