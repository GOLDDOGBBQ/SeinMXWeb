
@{
    ViewBag.Title = "Editar";
    //Layout = "_Layout";
}

@model SEINMX.Models.Inventario.CotizacionViewModel

<div class="container mt-4">

    @if (Model.Cotizacion == null)
    {
        <button class="btn btn-primary"
                onclick="location.href='@Url.Action("Crear", "Cotizacion")'">
            Crear Cotización
        </button>
        <hr/>
    }
    else
    {
        <div class="row">
            <div class="col-md-3">
                <div class="info-box bg-info">
                    <div class="info-box-content">
                        <span class="info-box-text">Numero de cotizacion</span>
                        <span class="info-box-number">@Model.Cotizacion.IdCotizacion</span>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="info-box bg-success">
                    <div class="info-box-content">
                        <span class="info-box-text">Sub total</span>
                        <span class="info-box-number">@Model.Cotizacion.SubTotal</span>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="info-box bg-warning">
                    <div class="info-box-content">
                        <span class="info-box-text">IVA</span>
                        <span class="info-box-number">@Model.Cotizacion.PorcentajeIva</span>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="info-box bg-primary">
                    <div class="info-box-content">
                        <span class="info-box-text">Total</span>
                        <span class="info-box-number">@Model.Cotizacion.Total</span>
                    </div>
                </div>
            </div>
        </div>

        <form id="formCotizacion" method="post" action="@Url.Action("Guardar", "Cotizacion")">

            <input type="hidden" name="IdCotizacion" value="@Model.Cotizacion.IdCotizacion"/>

            <div class="card card-primary mt-3">
                <div class="card-header">
                    <h3 class="card-title">Datos generales</h3>
                </div>

                <div class="card-body">

                    <div class="row">

                        <!-- Fecha -->
                        <div class="col-md-2">
                            <label class="form-label">Fecha</label>
                            <input type="date" name="Fecha" class="form-control"
                                   value="@Model.Cotizacion.Fecha?.ToString("yyyy-MM-dd")">
                        </div>

                        <!-- Tipo de Cambio -->
                        <div class="col-md-2">
                            <label class="form-label">Tipo Cambio</label>
                            <input type="number" step="0.0001" name="TipoCambio"
                                   class="form-control"
                                   value="@Model.Cotizacion.TipoCambio">
                        </div>

                        <!-- Tarifa -->
                        <div class="col-md-2">
                            <label class="form-label">Tarifa</label>
                            <input type="number" step="0.0001" name="Tarifa"
                                   class="form-control"
                                   value="@Model.Cotizacion.Tarifa">
                        </div>

                        <!-- IVA -->
                        <div class="col-md-2">
                            <label class="form-label">IVA (%)</label>
                            <input type="number" step="0.0001" name="PorcentajeIVA"
                                   class="form-control"
                                   value="@Model.Cotizacion.PorcentajeIva">
                        </div>

                        <!-- Descuento -->
                        <div class="col-md-2">
                            <label class="form-label">Descuento</label>
                            <input type="number" step="0.0001" name="Descuento"
                                   class="form-control"
                                   value="@Model.Cotizacion.Descuento">
                        </div>




                    </div>

                    <div class="row mt-3">
                        <!-- Usuario Responsable -->
                        <div class="col-md-3">
                            <label class="form-label">Usuario Responsable</label>
                            <select id="cmbUsuario" name="IdUsuarioResponsable" class="form-control select2-ajax"
                                    data-url="/Cotizaciones/BuscarUsuario"
                                    data-placeholder="Buscar usuario...">
                                @if (Model.Cotizacion.IdUsuarioResponsable != null)
                                {
                                    <option value="@Model.Cotizacion.IdUsuarioResponsable" selected>
                                        Model.Cotizacion.Responsable
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- Cliente -->
                        <div class="col-md-9">
                            <label class="form-label">Cliente</label>
                            <select id="cmbCliente" name="IdCliente" class="form-control select2-ajax"
                                    data-url="/Cotizaciones/BuscarCliente"
                                    data-placeholder="Buscar cliente...">
                                @if (Model.Cotizacion.IdCliente != null)
                                {
                                    <option value="@Model.Cotizacion.IdCliente" selected>
                                        @Model.Cotizacion.Cliente
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- Contacto -->
                        <div class="col-md-6">
                            <label class="form-label">Contacto</label>
                            <select id="cmbContacto" name="IdClienteeContacto" class="form-control select2-ajax"
                                    data-url="/Cotizaciones/BuscarContacto"
                                    data-placeholder="Buscar contacto...">
                                @if (Model.Cotizacion.IdClienteeContacto != null)
                                {
                                    <option value="@Model.Cotizacion.IdClienteeContacto" selected>
                                        @Model.Cotizacion.NombreContacto
                                    </option>
                                }
                            </select>
                        </div>

                        <!-- Razón Social -->
                        <div class="col-md-6">
                            <label class="form-label">Razón Social</label>
                            <select id="cmbRazon" name="IdClienteRazonSolcial" class="form-control select2-ajax"
                                    data-url="/Cotizaciones/BuscarRazon"
                                    data-placeholder="Buscar razón social...">
                                @if (Model.Cotizacion.IdClienteRazonSolcial != null)
                                {
                                    <option value="@Model.Cotizacion.IdClienteRazonSolcial" selected>
                                        @Model.Cotizacion.RazonSocial
                                    </option>
                                }
                            </select>
                        </div>


                    </div>

                    <div class="row mt-3">
                        <div class="col-md-12">
                            <label class="form-label">Observaciones</label>
                            <textarea name="Observaciones" class="form-control"
                                      rows="3">@Model.Cotizacion.Observaciones</textarea>
                        </div>
                    </div>

                </div>

                <div class="card-footer text-end">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </div>
        </form>
    }
</div>

@section Scripts {
    <script>
        $('.select2-ajax').each(function () {

            let control = $(this);

            control.select2({
                theme: "bootstrap-5",
                placeholder: control.data("placeholder"),
                minimumInputLength: 1,
                ajax: {
                    url: control.data("url"),
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {q: params.term};
                    },
                    processResults: function (data) {
                        return {
                            results: data.map(x => ({
                                id: x.id,
                                text: x.text
                            }))
                        };
                    }
                }
            });
        });
    </script>
}
